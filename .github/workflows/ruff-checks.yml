name: âœ… Checks

on:
  pull_request:
    branches: ["main"]
    paths:
      - "python/agents/**"
      - "pyproject.toml"

permissions:
  contents: read
  pull-requests: write # Essential for posting the suggestion comments

jobs:
  ruff-format-suggestions:
    name: Ruff Format & Lint Suggestions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          python-version: "3.13"
    
      - name: Install Reviewdog
        uses: reviewdog/action-setup@v1
        with:
          reviewdog_version: latest

      # We run Ruff via Reviewdog to generate the UI suggestions
      - name: Run Ruff and Post Suggestions
        env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Apply linting fixes and formatting to the local runner filesystem
          uvx ruff check --fix .
          uvx ruff format .

          # 2. Use git diff to see what changed, and pipe it to reviewdog
          # reviewdog -f=diff will turn git patches into GitHub suggestions
          git diff | reviewdog -f=diff \
                               -name="ruff-suggester" \
                               -reporter=github-pr-review \
                               -filter-mode=added \
                               -fail-on-error=true
